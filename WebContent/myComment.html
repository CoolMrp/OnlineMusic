<!-- <%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %> -->
<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<link rel="shortcut icon" type="images/x-icon" href="images/title.ico">
<title>æˆ‘çš„è¯„è®º</title>
<meta name="description" content="">
<meta name="keywords" content="">
<link href="css/common.css" rel="stylesheet">
<link href="css/myComment.css" rel="stylesheet">
<link href="css/iconfont.css" rel="stylesheet">
<script src="js/adaptation.js"></script>
<script src="js/lyric.js"></script>
<script src="js/jquery-1.11.3.min.js" type="text/javascript"></script>
</head>
<body>
    <div id="main">
      <div class="header">
        <span style="position:absolute;left:10px;" onclick="back()"><i class="iconfont icon-fanhui1" style="font-size:20px;"></i></span>
        <p class="title">æˆ‘çš„è¯„è®ºï¼ˆ0ï¼‰</p>
      </div>
      <div class="box">
        <div class="song">
          <div class="pic">
            <img id="album" src="" alt="ä¸“è¾‘"/>
          </div>
          <div class="singer">
            <!-- <p>å¿ƒå¦‚æ­¢æ°´</p>
            <p>coolmrp</p> -->
          </div>
        </div>
        <div class="content">
          <p class="tip">å°å¯çˆ±ï¼Œä½ æš‚æ— è¯„è®ºï¼Œèµ¶ç´§å»æŠ¢åº§å§ğŸ˜Š</p>
          <ul class="list">
            <!-- <li>
              <p class="commentator">
                <img src="./images/homeBg.jpg" alt="img" />
                <span class="user">
                  <i style="font-size:14px;">æ¸…é£çƒŸé›¨</i>
                  <i style="font-size:12px;color:#666">3æœˆ15æ—¥</i>
                </span>
                <span class="fabulous">21.7ä¸‡<i class="iconfont icon-zan2" style="font-size:20px;" id="1"></i></span>
              </p>
              <p style="margin:10px 0 10px 35px;padding: 10px 0;border-bottom:1px solid #ddd;">è¿™æ­Œä¹Ÿå¤ªå¥½å¬äº†ä½ å‘€ï¼Œå¿ƒå¦‚æ­¢æ°´ï¼Œå†æ— æ³¢åŠ¨ï¼ï¼ï¼</p>
            </li> -->
          </ul>
        </div>
      </div>
      <div class="alertTip"></div>
      <div class="alert">
      	<p class="text">æ€ä¹ˆä¸ç™»å½•å°±è¿›æ¥äº†å‘¢ï¼Œèµ¶å¿«å»ç™»å½•ï¼Œä¹–ğŸ˜Šï½ï½ï½</p>
      	<p class="btn" onclick="window.location.href='./login.html'">å»ç™»å½•</p>
      </div>
    </div>
    <script>
      var praiseNum; // ç‚¹èµæ•°é‡
      var fabulousId = []; // å­˜æ”¾è¯„è®ºåˆ—è¡¨id
      init();
      function init() { // åˆå§‹åŒ–
    	  var uid = getCookie("uid");
    	  var userName = getCookie("userName");
    	  if (!uid){
    		  $(".alert").show("slow");
    	  }
    	  $.ajax({
				"async": false,
				"url": "/music/getUserInfo",
				"data": {"userName":userName},
				"type": "POST",
				"dataType": "json",
				"success": function (data) {
					console.log(data);
					document.getElementById("album").src = data.portrait;
					getClass("singer")[0].innerHTML = "<p>"+data.username+"</p>";
				},
				"error":function(xhr, status, errMsg){
		            console.log("é”™è¯¯:"+errMsg);
		        }
			})
    	  $.ajax({
				"async": false,
				"url": "/music/getSongComment",
				"data": {"uid": uid,"method": "myComment"},
				"type": "POST",
				"dataType": "json",
				"success": function (data) {
					console.log(data);
					callback(data);
				},
				"error":function(xhr, status, errMsg){
		            console.log("é”™è¯¯:"+errMsg);
		        }
			})
      }
      // æˆåŠŸå›è°ƒå‡½æ•°
      function callback (data){
    	  var title = getClass("title")[0];
    	  var list = getClass("list")[0];
    	  if (data.length > 0) {
    		  title.innerText = "æˆ‘çš„è¯„è®ºï¼ˆ"+data.length+"ï¼‰";
    		  $(".tip").text("ç²¾å½©è¯„è®º");
    		  $(".tip").css({"color":"#000","text-align":"left"});
    		  list.innerHTML = ""; // æ¸…ç©ºåˆ—è¡¨
    		  fabulousId = [];  // æ¸…ç©ºæ•°ç»„
        	  for (var i=0,len=data.length;i<len;i++) {
        		  fabulousId.push(data[i].fabulousId);
        		  var commentList = '<li><p class="commentator"><img style="border-radius:0;" src="'+lrc[parseInt(data[i].sid)].album+'" alt="img" /><span class="user"><i style="font-size:14px;">'+lrc[parseInt(data[i].sid)].songName+'-'+lrc[parseInt(data[i].sid)].singer+'</i><i style="font-size:12px;color:#666">'+data[i].commentDate+'</i></span><span class="fabulous"><i style="color:#bbb;">'+data[i].praiseNum+'</i><i class="praise iconfont icon-zan2" style="font-size:20px;color:#bbb;"></i></span></p><p style="margin-left: 45px;padding: 5px 0;border-bottom:1px solid #ddd;color:#09c">'+data[i].comtent+'</p></li>';
            	  list.innerHTML += commentList;
            	  praiseNum = document.getElementsByClassName("praise");
        	  }
    	  }
      }
      // è¿”å›
      function back () {
    	  window.location.href = "./index.html";
      } 
    	//è·å–ç±»å
        function getClass(cName){
          if(window.getElementsByClassName){
            return document.getElementsByClassName("cName");
          }else{
            var arr = [];
            var all = document.getElementsByTagName("*");
            for(var i=0;i<all.length;i++){
              if(cName==all[i].className){
                arr.push(all[i]);
              }
            }
            return arr;
          }
        }
   		// è·å–cookie
		function getCookie(key){
			var cookie = document.cookie;
			var reg = new RegExp("(\\s|^)"+key+"=([^;]*)(;|$)");
			var s = cookie.match(reg);
			return s?s[2]:"";
		}
    </script>
</body>
</html>






